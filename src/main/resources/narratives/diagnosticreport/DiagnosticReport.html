<!--/*-->
<html>
<head>
    <link rel="stylesheet" type="text/css" href="narrative.css"/>
</head>
<body>
<!--*/-->

<div>
    <div class="hapiHeaderText">
        <!--/*
        Show the DiagnosticReport's name.text value, or if that isn't populated, show the
        display value on the first coding, and if that's missing too show a default "Untitled"
        value
        */-->
        <th:block th:if="${not resource.code.textElement.empty} or ${resource.code.coding.empty}"
                  th:text="${resource.code.textElement.value}"/>
        <th:block
                th:if="${not resource.code.coding.empty} and ${resource.code.textElement.empty} and ${not resource.code.coding[0].displayElement.empty}"
                th:text="${resource.code.coding[0].display}"/>
        <th:block
                th:if="${not resource.code.coding.empty} and ${resource.code.textElement.empty} and ${resource.code.coding[0].displayElement.empty}"
                th:text="'Untitled Diagnostic Report'"/>
        <!--/*--> Complete Blood Count <!--*/-->
    </div>

    <table class="hapiPropertyTable">
        <thead><tr><td colspan="2">Result information</td></tr></thead>
        <tbody>
        <tr th:if="${not resource.statusElement.empty}">
            <td>Status</td>
            <td th:text="${resource.statusElement.value}">Final</td>
        </tr>
        <tr th:if="${not resource.issuedElement.empty}">
            <td>Issued</td>
            <td th:narrative="${resource.issuedElement}">--</td>
        </tr>
        <tr th:if="${not resource.conclusionElement.empty}">
            <td>Conclusion</td>
            <td th:narrative="${resource.conclusionElement}">No conclusion was integrated in this report</td>
        </tr>
        </tbody>

        <th:block th:if="${not resource.subject.resource.empty}">
            <thead><tr><td colspan="2">Patient details</td></tr></thead>
            <tbody>
            <tr th:if="${not resource.subject.resource.identifier.empty}">
                <td>Identifier</td>
                <td th:narrative="${resource.subject.resource.identifier[0]}"></td>
            </tr>
            <tr th:if="${not resource.subject.resource.name.empty}">
                <td>Patient name</td>
                <td th:text="${resource.subject.resource.name[0].nameAsSingleString}">--</td>
            </tr>
            <tr th:if="${not resource.subject.resource.birthDateElement.empty}">
                <td>Date of birth</td>
                <td><span
                        th:text="${#dates.format(resource.subject.resource.birthDateElement.value,'dd MMMM yyyy')}"></span>
                </td>
            </tr>
            <tr th:if="${not resource.subject.resource.address.empty}">
                <td>Address</td>
                <td th:narrative="${resource.subject.resource.address[0]}"></td>
            </tr>
            </tbody>
            <!-- Service Request -->
            <th:block th:if="${resource.hasBasedOn}" th:each="basedOn : ${resource.basedOn}">
                <thead><tr><td colspan="2">Service request details</td></tr></thead>
                <tbody>
                    <tr th:if="${basedOn.resource.hasIdentifier}">
                        <td>Identifier</td>
                        <td th:narrative="${basedOn.resource.identifier[0]}"></td>
                    </tr>
                    <!-- Subject -->
                    <tr th:if="${basedOn.resource.hasSubject}">
                        <td>Subject</td>
                        <td>
                            <th:block th:text="${basedOn.resource.subject.resource.name[0].nameAsSingleString}">--</th:block>
                            <th:block th:text="' (' + ${basedOn.resource.subject.resource.identifier[0].value} + ')'"> (--)</th:block>
                        </td>
                    </tr>
                    <!-- Status -->
                    <tr th:if="${basedOn.resource.hasStatusElement}">
                        <td>Status</td>
                        <td th:narrative="${basedOn.resource.statusElement}"></td>
                    </tr>
                    <!-- Intent -->
                    <tr th:if="${basedOn.resource.hasIntentElement}">
                        <td>Intent</td>
                        <td th:narrative="${basedOn.resource.intentElement}"></td>
                    </tr>
                    <!-- Category -->
                    <th:block th:if="${basedOn.resource.hasCategory}"  th:each="category : ${basedOn.resource.category}">
                            <tr>
                                <td>Category</td>
                                <td th:include="@{inlinecode} :: inlinecode (${category})"></td>
                            </tr>
                    </th:block>
                    <!-- Priority -->
                    <tr th:if="${basedOn.resource.hasPriorityElement}">
                        <td>Priority</td>
                        <td th:narrative="${basedOn.resource.priorityElement}"></td>
                    </tr>
                    <!-- Authored on -->
                    <tr th:if="${basedOn.resource.hasAuthoredOnElement}">
                        <td>Authored on</td>
                        <td th:text="${#dates.format(basedOn.resource.authoredOnElement.value,'dd MMMM yyyy hh:mm:ss')}"></td>
                    </tr>
                    <!-- Requester -->
                    <tr th:if="${basedOn.resource.hasRequester}">
                        <td>Requester</td>
                        <td>
                            <th:block th:if="${basedOn.resource.requester.resource.hasName}"
                                      th:text="${basedOn.resource.requester.resource.name[0].nameAsSingleString}">(name?)
                            </th:block>
                            <th:block th:if="${basedOn.resource.requester.resource.hasIdentifier and basedOn.resource.requester.resource.identifier[0].hasSystemElement}"
                                      th:text="' (' + ${#strings.replace(basedOn.resource.requester.resource.identifier[0].system,'https://www.ehealth.fgov.be/standards/fhir/NamingSystem/','')} + ')'"> (system?)
                            </th:block>
                            <th:block th:if="${basedOn.resource.requester.resource.hasIdentifier and basedOn.resource.requester.resource.identifier[0].hasValueElement}"
                                      th:text="' (' + ${basedOn.resource.requester.resource.identifier[0].value} + ')'"> (value?)
                            </th:block>
                        </td>
                    </tr>
                </tbody>
            </th:block>
            <!-- Specimen details -->
            <th:block th:if="${resource.hasSpecimen}" th:each="specimen : ${resource.specimen}">
                <thead><tr><td colspan="2">Specimen details</td></tr></thead>
                <tbody>
                    <!-- Identifier -->
                    <tr th:if="${specimen.resource.hasIdentifier}">
                        <td>Identifier</td>
                        <td th:narrative="${specimen.resource.identifier[0]}"></td>
                    </tr>
                    <!-- Status -->
                    <tr th:if="${specimen.resource.hasStatusElement}">
                        <td>Status</td>
                        <td th:narrative="${specimen.resource.statusElement}"></td>
                    </tr>
                    <!-- Type -->
                    <tr th:if="${specimen.resource.hasType}">
                        <td>Type</td>
                        <td th:include="@{inlinecode} :: inlinecode (${specimen.resource.type})"></td>
                    </tr>
                    <!-- Subject -->
                    <tr th:if="${specimen.resource.hasSubject}">
                        <td>Patient</td>
                        <td>
                            <th:block th:text="${specimen.resource.subject.resource.name[0].nameAsSingleString}">--</th:block>
                            <th:block th:text="' (' + ${specimen.resource.subject.resource.identifier[0].value} + ')'"> (--)</th:block>
                        </td>
                    </tr>
                    <!-- Received time -->
                    <tr th:if="${specimen.resource.hasReceivedTimeElement}">
                        <td>Received</td>
                        <td th:text="${#dates.format(specimen.resource.receivedTimeElement.value,'dd MMMM yyyy hh:mm:ss')}"></td>
                    </tr>
                    <!-- Requests -->
                    <th:block th:if="${not specimen.resource.hasRequest}" th:each="request : ${specimen.resource.request}">
                        <tr th:if="${request.resource.hasIdentifier">
                            <td>Request</td>
                            <td th:narrative="${request.resource.identifier[0]}">--</td>
                        </tr>
                    </th:block>
                    <!-- Specimen collection -->
                    <th:block if="${specimen.resource.hasCollection}">
                        <!-- Collection collector -->
                        <tr th:if="${specimen.resource.collection.hasCollector}">
                            <td>Collector</td>
                            <td>
                                <th:block th:if="${specimen.resource.collection.collector.resource.hasName}"
                                          th:text="${specimen.resource.collection.collector.resource.name[0].nameAsSingleString}">(name?)
                                </th:block>
                                <th:block th:if="${specimen.resource.collection.collector.resource.hasIdentifier and specimen.resource.collection.collector.resource.identifier[0].hasSystemElement}"
                                          th:text="' (' + ${#strings.replace(specimen.resource.collection.collector.resource.identifier[0].system,'https://www.ehealth.fgov.be/standards/fhir/NamingSystem/','')} + ')'"> (system?)
                                </th:block>
                                <th:block th:if="${specimen.resource.collection.collector.resource.hasIdentifier and specimen.resource.collection.collector.resource.identifier[0].hasValueElement}"
                                          th:text="' (' + ${specimen.resource.collection.collector.resource.identifier[0].value} + ')'"> (value?)
                                </th:block>
                            </td>
                        </tr>
                        <!-- Collection collected date -->
                        <tr th:if="${specimen.resource.collection.hasCollectedDateTimeType}">
                            <td>Collected date</td>
                            <td th:text="${#dates.format(specimen.resource.collection.collectedDateTimeType.value,'dd MMMM yyyy hh:mm:ss')}"></td>
                        </tr>
                        <!-- Collection collected period -->
                        <tr th:if="${specimen.resource.collection.hasCollectedPeriod}">
                            <td>Collected period</td>
                            <td>
                                <th:block th:if="${specimen.resource.collection.collectedPeriod.hasStart}"
                                          th:text="${#dates.format(specimen.resource.collection.collectedPeriod.start,'dd MMMM yyyy hh:mm:ss')}">...</th:block>
                                -
                                <th:block th:if="${specimen.resource.collection.collectedPeriod.hasEnd}"
                                          th:text="${#dates.format(specimen.resource.collection.collectedPeriod.end,'dd MMMM yyyy hh:mm:ss')}">...</th:block>
                            </td>
                        </tr>
                        <!-- Collection duration -->
                        <tr th:if="${specimen.resource.collection.hasDuration}">
                            <td>Duration</td>
                            <td th:narrative="${specimen.resource.collection.duration}"></td>
                        </tr>
                        <!-- Collection quantity -->
                        <tr th:if="${specimen.resource.collection.hasQuantity}">
                            <td>Quantity</td>
                            <td th:narrative="${specimen.resource.collection.quantity}"></td>
                        </tr>
                        <!-- Collection method -->
                        <tr th:if="${specimen.resource.collection.hasMethod}">
                            <td>Method</td>
                            <td th:include="@{inlinecode} :: inlinecode (${specimen.resource.collection.method})"></td>
                        </tr>
                        <!-- Collection body site -->
                        <tr th:if="${specimen.resource.collection.hasBodySite}">
                            <td>Body site</td>
                            <td th:include="@{inlinecode} :: inlinecode (${specimen.resource.collection.bodySite})"></td>
                        </tr>
                        <!-- Collection fasted status (CodeableConcept)-->
                        <tr th:if="${specimen.resource.collection.hasFastingStatusCodeableConcept}">
                            <td>Fasting status</td>
                            <td th:include="@{inlinecode} :: inlinecode (${specimen.resource.collection.fastingStatusCodeableConcept})"></td>
                        </tr>
                        <!-- Fasted status (Duration) -->
                        <tr th:if="${specimen.resource.collection.hasFastingStatusDuration}">
                            <td>Fasting status</td>
                            <td th:narrative="${specimen.resource.collection.fastingStatusDuration}"></td>
                        </tr>
                        <!-- Processings -->
                        <th:block th:if="${specimen.resource.hasProcessing}" th:each="processing : ${specimen.resource.processing}">
                            <tr>
                                <td>Processing</td>
                                <th:block th:if="${processing.hasProcedure}">
                                    <td th:include="@{inlinecode} :: inlinecode (${processing.procedure})"></td>
                                </th:block>
                                <th:block th:if="${not processing.hasProcedure}">
                                    <td>(processing without procedure?)</td>
                                </th:block>
                            </tr>
                        </th:block>
                        <!-- Containers -->
                        <tr th:if="${specimen.resource.hasContainer}"  th:each="container : ${specimen.resource.container}">
                                <td>Container</td>
                            <th:block th:if="${container.hasType}">
                                <td th:include="@{inlinecode} :: inlinecode (${container.type})"></td>
                            </th:block>
                            <th:block th:if="${not container.hasType}">
                                <td>(type?)</td>
                            </th:block>
                        </tr>
                        <!-- Condition -->
                        <tr th:if="${specimen.resource.hasCondition}">
                            <td>Condition</td>
                            <td th:include="@{inlinecode} :: inlinecode (${specimen.resource.condition})"></td>
                        </tr>
                        <!-- Notes -->
                        <tr th:if="${specimen.resource.hasNote}" th:each="note : ${specimen.resource.note}">
                            <td>Note</td>
                            <td th:include="@{inlineannotation} :: inlineannotation (${note})"></td>
                        </tr>
                    </th:block>
                </tbody>
            </th:block>
        </th:block>

    </table>

    <table class="hapiTableOfValues" th:if="${not #lists.isEmpty(resource.result)}">
        <thead>
        <tr>
            <td>Name</td>
            <td>Value</td>
            <td>Interpretation</td>
            <td>Reference Range</td>
            <td>Status</td>
        </tr>
        </thead>
        <tbody th:include="@{observations} :: observations (items=${resource.result},level=0)">
        </tbody>
    </table>

</div>


<!--/*-->
</body>
</html>
<!--*/-->
